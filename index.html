<script>
    // 1. Renderizar la lista de publicaciones desde POSTS (de posts.js)
    const pubList = document.getElementById('pub-list');
    const noResults = document.getElementById('no-results');

    function renderPosts(filterTag = 'all') {
        pubList.innerHTML = ''; // Limpiar lista
        let visibleCount = 0;

        POSTS.forEach(post => {
            // Filtrado por etiquetas
            if (filterTag !== 'all' && !post.tags.includes(filterTag)) return;

            visibleCount++;
            const item = document.createElement('a');
            item.href = post.url;
            item.className = 'pub-item';
            
            // Generar etiquetas HTML
            const tagsHTML = post.tags.map(t => `<span class="pub-tag">${t}</span>`).join('');

            item.innerHTML = `
                <div class="pub-left">
                    <span class="pub-author">${post.author}</span>
                    <span class="pub-date">${post.date}</span>
                </div>
                <div class="pub-center">
                    <span class="pub-title">${post.title}</span>
                    <span class="pub-tldr">${post.tldr}</span>
                    <div class="pub-tags">${tagsHTML}</div>
                </div>
                <div class="pub-right">
                    <span class="pub-type ${post.type}">${post.type.charAt(0).toUpperCase() + post.type.slice(1)}</span>
                    <span class="pub-readtime">${post.readtime}</span>
                </div>
            `;
            pubList.appendChild(item);
        });

        // Mostrar mensaje si no hay resultados
        if (visibleCount === 0) {
            const emptyMsg = document.createElement('div');
            emptyMsg.className = 'pub-empty';
            emptyMsg.innerHTML = '<span class="pub-empty-glyph">∅</span><p>Nada en esta sección todavía.</p>';
            pubList.appendChild(emptyMsg);
        }
    }

    // 2. Actualizar contadores de autores automáticamente
    function updateAuthorCounts() {
        const columns = document.querySelectorAll('.author-column');
        columns.forEach(col => {
            const slug = col.getAttribute('href').replace('/', '');
            const count = POSTS.filter(p => p.authorSlug === slug).length;
            const countLabel = col.querySelector('.author-column-count');
            if (countLabel) {
                countLabel.textContent = `${count} ${count === 1 ? 'entrada' : 'entradas'}`;
            }
        });
    }

    // 3. Manejo de Filtros
    const btns = document.querySelectorAll('.tag-btn');
    btns.forEach(btn => {
        btn.addEventListener('click', () => {
            btns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderPosts(btn.dataset.tag);
        });
    });

    // Inicializar al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof POSTS !== 'undefined') {
            renderPosts();
            updateAuthorCounts();
        } else {
            console.error("No se encontró el archivo posts.js");
        }
    });
</script>
